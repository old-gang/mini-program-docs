<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>分包 | 小程序</title><meta name="description" content="微信小程序（Mini Program），简称小程序，是一种不需要下载安装即可使用的应用">
    <link rel="modulepreload" href="/mini-program-docs/assets/app.19a248fc.js"><link rel="modulepreload" href="/mini-program-docs/assets/subpackages.html.68cab13e.js"><link rel="modulepreload" href="/mini-program-docs/assets/subpackages.html.ea726770.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.5eab30c3.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.c457182c.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.b90a2a4d.js"><link rel="prefetch" href="/mini-program-docs/assets/api.html.58c74447.js"><link rel="prefetch" href="/mini-program-docs/assets/c_project.html.c1895e00.js"><link rel="prefetch" href="/mini-program-docs/assets/dispatch.html.395a1c76.js"><link rel="prefetch" href="/mini-program-docs/assets/global_config.html.b96d20bd.js"><link rel="prefetch" href="/mini-program-docs/assets/life_circle.html.e6b13d90.js"><link rel="prefetch" href="/mini-program-docs/assets/page_config.html.0e2d0cec.js"><link rel="prefetch" href="/mini-program-docs/assets/plug.html.c9f1f909.js"><link rel="prefetch" href="/mini-program-docs/assets/profile.html.bb19dcf1.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.35a7cd94.js"><link rel="prefetch" href="/mini-program-docs/assets/routes.html.dc059d9a.js"><link rel="prefetch" href="/mini-program-docs/assets/tool_desc.html.3706be69.js"><link rel="prefetch" href="/mini-program-docs/assets/wxml.html.6feb32f3.js"><link rel="prefetch" href="/mini-program-docs/assets/wxs.html.2a35273c.js"><link rel="prefetch" href="/mini-program-docs/assets/customComponent.html.ca6bc96f.js"><link rel="prefetch" href="/mini-program-docs/assets/customTabbar.html.453ae7c1.js"><link rel="prefetch" href="/mini-program-docs/assets/stateManger.html.7d53b06e.js"><link rel="prefetch" href="/mini-program-docs/assets/use_vantUI.html.0304baea.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.17708587.js"><link rel="prefetch" href="/mini-program-docs/assets/flex.html.fc20f832.js"><link rel="prefetch" href="/mini-program-docs/assets/mobile.html.6dff4ef1.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.45a63e0c.js"><link rel="prefetch" href="/mini-program-docs/assets/404.html.265028f6.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.9f2f767a.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.7c15cfd6.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.c148f322.js"><link rel="prefetch" href="/mini-program-docs/assets/api.html.8fabdca4.js"><link rel="prefetch" href="/mini-program-docs/assets/c_project.html.2760d6b1.js"><link rel="prefetch" href="/mini-program-docs/assets/dispatch.html.0b7f32f1.js"><link rel="prefetch" href="/mini-program-docs/assets/global_config.html.50f929d3.js"><link rel="prefetch" href="/mini-program-docs/assets/life_circle.html.38c48348.js"><link rel="prefetch" href="/mini-program-docs/assets/page_config.html.0c877ed6.js"><link rel="prefetch" href="/mini-program-docs/assets/plug.html.0dc64cdf.js"><link rel="prefetch" href="/mini-program-docs/assets/profile.html.9d930184.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.b0193db7.js"><link rel="prefetch" href="/mini-program-docs/assets/routes.html.039c6971.js"><link rel="prefetch" href="/mini-program-docs/assets/tool_desc.html.6c0b6946.js"><link rel="prefetch" href="/mini-program-docs/assets/wxml.html.c7c73fb1.js"><link rel="prefetch" href="/mini-program-docs/assets/wxs.html.aab2b34f.js"><link rel="prefetch" href="/mini-program-docs/assets/customComponent.html.f757031e.js"><link rel="prefetch" href="/mini-program-docs/assets/customTabbar.html.753fe5c7.js"><link rel="prefetch" href="/mini-program-docs/assets/stateManger.html.51ca3d2f.js"><link rel="prefetch" href="/mini-program-docs/assets/use_vantUI.html.5890a29e.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.d2ca1359.js"><link rel="prefetch" href="/mini-program-docs/assets/flex.html.6392476d.js"><link rel="prefetch" href="/mini-program-docs/assets/mobile.html.eec0fc3f.js"><link rel="prefetch" href="/mini-program-docs/assets/index.html.f8b07048.js"><link rel="prefetch" href="/mini-program-docs/assets/404.html.377ad5d2.js"><link rel="prefetch" href="/mini-program-docs/assets/404.cd929c6b.js"><link rel="prefetch" href="/mini-program-docs/assets/Layout.54a2e938.js">
    <link rel="stylesheet" href="/mini-program-docs/assets/style.f6dfbb02.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/mini-program-docs/" class=""><!----><span class="site-name">小程序</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">分包 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#分包的作用" class="router-link-active router-link-exact-active sidebar-item" aria-label="分包的作用"><!--[--><!--]--> 分包的作用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#分包前后对比" class="router-link-active router-link-exact-active sidebar-item" aria-label="分包前后对比"><!--[--><!--]--> 分包前后对比 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#分包前后的加载方式对比" class="router-link-active router-link-exact-active sidebar-item" aria-label="分包前后的加载方式对比"><!--[--><!--]--> 分包前后的加载方式对比 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#使用分包" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用分包"><!--[--><!--]--> 使用分包 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#_1-在app-json中新增subpackages字段配置分包" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.在app.json中新增subpackages字段配置分包"><!--[--><!--]--> 1.在app.json中新增subpackages字段配置分包 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#_2-分包配置完毕之后-微信小程序开发工具会自动帮我们创建分包的目录" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.分包配置完毕之后,微信小程序开发工具会自动帮我们创建分包的目录"><!--[--><!--]--> 2.分包配置完毕之后,微信小程序开发工具会自动帮我们创建分包的目录 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#_3-进入分包页面示例代码" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.进入分包页面示例代码"><!--[--><!--]--> 3.进入分包页面示例代码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#独立分包" class="router-link-active router-link-exact-active sidebar-item" aria-label="独立分包"><!--[--><!--]--> 独立分包 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#配置独立分包" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置独立分包"><!--[--><!--]--> 配置独立分包 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#分包预下载" class="router-link-active router-link-exact-active sidebar-item" aria-label="分包预下载"><!--[--><!--]--> 分包预下载 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#配置分包预下载" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置分包预下载"><!--[--><!--]--> 配置分包预下载 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#查看预下载包是否成功" class="router-link-active router-link-exact-active sidebar-item" aria-label="查看预下载包是否成功"><!--[--><!--]--> 查看预下载包是否成功 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#分包预下载的限制" class="router-link-active router-link-exact-active sidebar-item" aria-label="分包预下载的限制"><!--[--><!--]--> 分包预下载的限制 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#关于分包的其他注意问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="关于分包的其他注意问题"><!--[--><!--]--> 关于分包的其他注意问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#分包异步化" class="router-link-active router-link-exact-active sidebar-item" aria-label="分包异步化"><!--[--><!--]--> 分包异步化 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#跨分包自定义组件引用" class="router-link-active router-link-exact-active sidebar-item" aria-label="跨分包自定义组件引用"><!--[--><!--]--> 跨分包自定义组件引用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/mini-program-docs/mini_basic_use/mini_advanced/subpackages.html#跨分包-js-代码引用" class="router-link-active router-link-exact-active sidebar-item" aria-label="跨分包 JS 代码引用"><!--[--><!--]--> 跨分包 JS 代码引用 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="分包" tabindex="-1"><a class="header-anchor" href="#分包" aria-hidden="true">#</a> 分包</h1><h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍" aria-hidden="true">#</a> 介绍</h2><blockquote><p>微信客户端 6.6.0，基础库 1.7.3 及以上版本开始支持。</p><p>开发者将一个小程序项目划分成不同的子包，最终在构建时打包成不同的分包</p></blockquote><h3 id="分包的作用" tabindex="-1"><a class="header-anchor" href="#分包的作用" aria-hidden="true">#</a> 分包的作用</h3><ul><li><p>增加整体项目的体积. 没有分包的情况下项目压缩之后的整体大小不能超过 2M. 使用分包技术,项目压缩之后整体大小不能超过 20M(如果超过限制,则无法发布小程序)</p></li><li><p>利用分包技术可以实现按需加载</p></li><li><p>团队共同开发时可以更好的解耦协作</p></li></ul><h3 id="分包前后对比" tabindex="-1"><a class="header-anchor" href="#分包前后对比" aria-hidden="true">#</a> 分包前后对比</h3><ul><li>分包之前, 项目中所有的资源都打包成一个包</li><li>分包之后,项目的启动页面和 tabbar 页面以及项目公共资源打包成一个主包, 分包页面和分包的私有资源打包成多个分包</li></ul><p><img src="/mini-program-docs/images/分包.png" alt="分包前后对比"></p><h3 id="分包前后的加载方式对比" tabindex="-1"><a class="header-anchor" href="#分包前后的加载方式对比" aria-hidden="true">#</a> 分包前后的加载方式对比</h3><ul><li><p>分包前: 在小程序启动时,由于只有一个包,所以会一次性加载这个包中所有资源</p></li><li><p>分包后: 在小程序启动时，默认会下载主包并启动主包内页面，当用户进入分包内某个页面时，客户端会把对应分包下载下来，下载完成后再进行展示。</p></li></ul><h2 id="使用分包" tabindex="-1"><a class="header-anchor" href="#使用分包" aria-hidden="true">#</a> 使用分包</h2><h3 id="_1-在app-json中新增subpackages字段配置分包" tabindex="-1"><a class="header-anchor" href="#_1-在app-json中新增subpackages字段配置分包" aria-hidden="true">#</a> 1.在<code>app.json</code>中新增<code>subpackages</code>字段配置分包</h3><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
<span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/logs/logs&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token comment">// 配置分包</span>
<span class="token property">&quot;subpackages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 数组中有两个对象,表示配置了两个分包</span>
    <span class="token punctuation">{</span>
    <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packageA&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 分包的根目录</span>
    <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/cat/cat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/dog/dog&quot;</span><span class="token punctuation">]</span> <span class="token comment">// 分包中页面路径,基于分包根目录</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
    <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packageB&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/apple/apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/banana/banana&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token property">&quot;style&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;sitemapLocation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sitemap.json&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-分包配置完毕之后-微信小程序开发工具会自动帮我们创建分包的目录" tabindex="-1"><a class="header-anchor" href="#_2-分包配置完毕之后-微信小程序开发工具会自动帮我们创建分包的目录" aria-hidden="true">#</a> 2.分包配置完毕之后,微信小程序开发工具会自动帮我们创建分包的目录</h3><p><img src="/mini-program-docs/images/subp1.png" alt="配置分包创建的目录"></p><h3 id="_3-进入分包页面示例代码" tabindex="-1"><a class="header-anchor" href="#_3-进入分包页面示例代码" aria-hidden="true">#</a> 3.进入分包页面示例代码</h3><p>3.1 在启动页面<code>index.wxml</code>中定义按钮组件并绑定点击事件</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>goToSubPackageACat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>跳转到分包A的Cat页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3.2 在<code>index.js</code>中定义事件处理函数</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">goToSubPackageACat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token comment">// 利用编程式导航切换页面</span>
 wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;/packageA/pages/cat/cat&#39;</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="独立分包" tabindex="-1"><a class="header-anchor" href="#独立分包" aria-hidden="true">#</a> 独立分包</h2><p>独立分包是小程序中一种特殊类型的分包，可以独立于主包和其他分包运行。从独立分包中的页面进入小程序时，不需要下载主包。当用户进入普通分包或主包内页面时，主包才会被下载。</p><p>一个小程序中可以有多个独立分包。</p><h3 id="配置独立分包" tabindex="-1"><a class="header-anchor" href="#配置独立分包" aria-hidden="true">#</a> 配置独立分包</h3><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/logs/logs&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置分包</span>
   <span class="token property">&quot;subpackages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token comment">// 数组中有两个对象,表示配置了两个分包</span>
       <span class="token punctuation">{</span>
       <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packageA&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 分包的根目录</span>
       <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/cat/cat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/dog/dog&quot;</span><span class="token punctuation">]</span> <span class="token comment">// 分包中页面路径,基于分包根目录</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token punctuation">{</span>
       <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packageB&quot;</span><span class="token punctuation">,</span>
       <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/apple/apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/banana/banana&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token comment">// 此时packageB为独立分包</span>
       <span class="token property">&quot;independent&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token property">&quot;style&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;sitemapLocation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sitemap.json&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进入独立分包页面的方式和其他普通分包的方式一致</p><p>使用场景: 比如一个电商网站需要临时增加一个双 11 的页面,则可以使用独立分包.在不影响项目其他包的情况下快速添加,使用完毕之后快速剥离</p><h2 id="分包预下载" tabindex="-1"><a class="header-anchor" href="#分包预下载" aria-hidden="true">#</a> 分包预下载</h2><p>开发者可以通过配置，在进入小程序某个页面时，由框架自动预下载可能需要的分包，提升进入后续分包页面时的启动速度。</p><h3 id="配置分包预下载" tabindex="-1"><a class="header-anchor" href="#配置分包预下载" aria-hidden="true">#</a> 配置分包预下载</h3><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/logs/logs&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置分包</span>
   <span class="token property">&quot;subpackages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token comment">// 数组中有两个对象,表示配置了两个分包</span>
       <span class="token punctuation">{</span>
       <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packageA&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 分包的根目录</span>
       <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pA&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 分包别名</span>
       <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/cat/cat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/dog/dog&quot;</span><span class="token punctuation">]</span> <span class="token comment">// 分包中页面路径,基于分包根目录</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token punctuation">{</span>
       <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;packageB&quot;</span><span class="token punctuation">,</span>
       <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pB&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 分包别名</span>
       <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/apple/apple&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pages/banana/banana&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token comment">// 此时packageB为独立分包</span>
       <span class="token property">&quot;independent&quot;</span><span class="token operator">:</span><span class="token boolean">true</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token comment">// 配置分包预下载</span>
   <span class="token property">&quot;preloadRule&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// &quot;pages/index/index&quot; 是页面路径,当进入这个页面的时候,预下载指定的包</span>
    <span class="token property">&quot;pages/index/index&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// network是网络环境 值为all(不限网络)或wifi(只在连接wifi时下载)</span>
      <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// packages是进入页面后预下载分包的 root 或 name。__APP__ 表示主包。</span>
      <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packageA&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pages/logs/logs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wifi&quot;</span><span class="token punctuation">,</span>
      <span class="token comment">// 这里使用分包的别名(name)</span>
      <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pB&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">&quot;style&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">,</span>
   <span class="token property">&quot;sitemapLocation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sitemap.json&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查看预下载包是否成功" tabindex="-1"><a class="header-anchor" href="#查看预下载包是否成功" aria-hidden="true">#</a> 查看预下载包是否成功</h3><p><img src="/mini-program-docs/images/sub9.png" alt="切换网络"></p><p><strong>当网络状态为 4g 时:</strong></p><p>进入 logs 页面,分包预加载失败,因为预加载配置为 wifi <img src="/mini-program-docs/images/sub8.png" alt="失败"></p><p>进入 index 页面,分包预加载成功,因为预加载配置为 all <img src="/mini-program-docs/images/sub7.png" alt="成功"></p><h3 id="分包预下载的限制" tabindex="-1"><a class="header-anchor" href="#分包预下载的限制" aria-hidden="true">#</a> 分包预下载的限制</h3><p>同一个分包中的页面享有共同的预下载大小限额 2M，限额会在工具中打包时校验。</p><p>如，页面 A 和 B 都在同一个分包中，A 中预下载总大小 0.5M 的分包，B 中最多只能预下载总大小 1.5M 的分包。</p><h2 id="关于分包的其他注意问题" tabindex="-1"><a class="header-anchor" href="#关于分包的其他注意问题" aria-hidden="true">#</a> 关于分包的其他注意问题</h2><ul><li><p>声明 subpackages 后，将按 subpackages 配置路径进行打包，subpackages 配置路径外的目录将被打包到主包中</p></li><li><p>整个小程序所有分包大小不超过 20M,单个分包/主包大小不能超过 2M</p></li><li><p>分包中不能嵌套分包</p></li><li><p>分包之间是独立的,不能互相引用资源.但是普通分包可以引入主包的资源</p></li><li><p>特别注意: 独立分包不能引入主包的资源,甚至连 app.wxss 都无法使用. 独立分包也无法使用插件</p></li></ul><h2 id="分包异步化" tabindex="-1"><a class="header-anchor" href="#分包异步化" aria-hidden="true">#</a> 分包异步化</h2><blockquote><p>该特性需要基础库版本 2.11.2 或以上</p></blockquote><p>在小程序中，不同的分包对应不同的下载单元；因此，除了非独立分包可以依赖主包外，分包之间不能互相使用自定义组件或进行 require。「分包异步化」特性将允许通过一些配置和新的接口，使部分跨分包的内容可以等待下载后异步使用，从而一定程度上解决这个限制。</p><h3 id="跨分包自定义组件引用" tabindex="-1"><a class="header-anchor" href="#跨分包自定义组件引用" aria-hidden="true">#</a> 跨分包自定义组件引用</h3><ul><li><p>处理前</p><ol><li><p>在分包 packageA 中定义组件<code>simple-list</code></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- packageA/components/simple-list/simple-list.wxml, 忽略其他文件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{[<span class="token punctuation">&#39;</span>a<span class="token punctuation">&#39;</span>,<span class="token punctuation">&#39;</span>b<span class="token punctuation">&#39;</span>,<span class="token punctuation">&#39;</span>c<span class="token punctuation">&#39;</span>]}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> {{ item }} <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>在分包 packageB 中配置,希望使用 packageA 中的组件</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// /packageB/pages/apple/apple.json 忽略其他文件</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;sl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/packageA/components/simple-list/simple-list&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>当进入/packageB/pages/apple/apple 页面时,控制台提示找不到组件 <img src="/mini-program-docs/images/sub6.png" alt=""></p></li></ol></li><li><p>处理后</p><p>一个分包使用其他分包的自定义组件时，由于其他分包还未下载或注入，其他分包的组件处于不可用的状态。通过为其他分包的自定义组件设置<code>占位组件</code>，我们可以先渲染占位组件作为替代，在分包下载完成后再进行替换</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;usingComponents&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;sl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/packageA/components/simple-list/simple-list&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 配置 componentPlaceholder.</span>
  <span class="token property">&quot;componentPlaceholder&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 利用内置组件view,为simple-list组件占位</span>
    <span class="token property">&quot;sl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;view&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="跨分包-js-代码引用" tabindex="-1"><a class="header-anchor" href="#跨分包-js-代码引用" aria-hidden="true">#</a> 跨分包 JS 代码引用</h3><ul><li>在 packageA/pages/cat/cat.js 中希望使用 packageB 中的 utils.js</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//packageA/pages/cat/cat.js</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;../../../packageB/utils.js&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">utils</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>utils<span class="token punctuation">)</span> <span class="token comment">// {msg, getRandomIntInclusive}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mod<span class="token punctuation">,</span> errMsg <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mod<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>errMsg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// packageB/utils.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">&#39;getRandomIntInclusive函数返回min~max之间的随机整数,包含min和max&#39;</span><span class="token punctuation">,</span>
  <span class="token function">getRandomIntInclusive</span><span class="token punctuation">(</span><span class="token parameter">min<span class="token punctuation">,</span> max</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span>
    max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min <span class="token comment">//含最大值，含最小值</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/mini-program-docs/assets/app.19a248fc.js" defer></script>
  </body>
</html>
